<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LivabilityAI - YaÅŸam Kalitesi Skoru</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        heading: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        dark: '#0f172a',
                        card: 'rgba(30, 41, 59, 0.7)',
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #0f172a; color: #f8fafc; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .map-container { height: 400px; width: 100%; border-radius: 1rem; z-index: 1; }

        /* Loading Spinner */
        .loader { border: 4px solid rgba(255,255,255,0.1); border-left-color: #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Animations */
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col selection:bg-blue-500 selection:text-white">

    <div class="fixed inset-0 z-[-1]">
        <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-purple-900/30 rounded-full blur-[100px]"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-blue-900/30 rounded-full blur-[100px]"></div>
    </div>

    <header class="w-full py-6 px-8 flex justify-between items-center glass sticky top-0 z-50">
        <div class="flex items-center gap-2">
            <i class="fa-solid fa-city text-blue-400 text-2xl"></i>
            <span class="font-heading text-xl font-bold tracking-wide">Livability<span class="text-blue-400">AI</span></span>
        </div>
        <a href="#" class="text-sm text-slate-400 hover:text-white transition">v3.2 Beta</a>
    </header>

    <main class="flex-grow container mx-auto px-4 py-10 max-w-5xl">

        <div id="hero-section" class="text-center mb-12 fade-in">
            <div class="inline-block px-4 py-1 rounded-full bg-blue-500/10 text-blue-300 text-xs font-bold mb-4 border border-blue-500/20">
                ðŸš€ YAPAY ZEKA DESTEKLÄ° EMLAK ANALÄ°ZÄ°
            </div>
            <h1 class="font-heading text-4xl md:text-6xl font-bold mb-6 leading-tight text-transparent bg-clip-text bg-gradient-to-r from-blue-200 via-white to-purple-200">
                Evinizin GerÃ§ek <br> DeÄŸerini KeÅŸfedin
            </h1>
            <p class="text-slate-400 text-lg max-w-2xl mx-auto">
                Haritadan bir konum seÃ§in. Yapay zeka motorumuz uydu gÃ¶rÃ¼ntÃ¼lerini, gÃ¼rÃ¼ltÃ¼ haritalarÄ±nÄ± ve sosyal olanaklarÄ± analiz edip size gerÃ§ek yaÅŸam kalitesi skorunu sÃ¶ylesin.
            </p>
        </div>

        <div class="glass p-2 rounded-2xl shadow-2xl mb-8 fade-in">
            <div id="map" class="map-container"></div>
        </div>

        <div class="flex flex-col items-center justify-center gap-4 mb-16 fade-in">
            <p id="coords-display" class="font-mono text-sm text-blue-300 bg-blue-900/30 px-4 py-2 rounded-lg border border-blue-500/30 hidden">
                SeÃ§ilen Konum: <span id="lat-val">0.00</span>, <span id="lon-val">0.00</span>
            </p>

            <button id="analyze-btn" onclick="analyzeLocation()" disabled class="group relative px-8 py-4 bg-slate-700 text-slate-400 rounded-xl font-bold text-lg transition-all duration-300 w-full md:w-auto min-w-[250px] flex items-center justify-center gap-2 cursor-not-allowed">
                <span>Haritadan Konum SeÃ§in</span>
                <i class="fa-solid fa-location-dot"></i>
            </button>
        </div>

        <div id="loading-screen" class="hidden fixed inset-0 bg-slate-900/90 z-[60] flex flex-col items-center justify-center backdrop-blur-md">
            <div class="loader mb-6"></div>
            <h3 class="text-2xl font-bold text-white mb-2">Analiz YapÄ±lÄ±yor</h3>
            <p id="loading-text" class="text-slate-400 text-sm font-mono">Uydu verileri indiriliyor...</p>
        </div>

        <div id="results-section" class="hidden space-y-6 fade-in">

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="col-span-1 glass rounded-3xl p-8 flex flex-col items-center justify-center text-center relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gradient-to-b from-blue-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    <h3 class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-4">GENEL SKOR</h3>

                    <div class="relative w-40 h-40 flex items-center justify-center">
                        <svg class="w-full h-full" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" fill="none" stroke="#1e293b" stroke-width="8" />
                            <circle id="score-circle" cx="50" cy="50" r="45" fill="none" stroke="#3b82f6" stroke-width="8" stroke-dasharray="283" stroke-dashoffset="283" transform="rotate(-90 50 50)" class="transition-all duration-1000 ease-out" />
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center flex-col">
                            <span id="main-score" class="text-5xl font-bold font-heading">0</span>
                            <span class="text-xs text-slate-500">/ 100</span>
                        </div>
                    </div>

                    <div id="score-label" class="mt-4 text-xl font-bold text-blue-400">MÃ¼kemmel</div>
                </div>

                <div class="col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="glass rounded-2xl p-6 hover:bg-white/5 transition">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="p-2 bg-purple-500/20 rounded-lg text-purple-400"><i class="fa-solid fa-users-rays"></i></div>
                            <h4 class="font-semibold">Mahalle Karakteri</h4>
                        </div>
                        <div id="vibe-tag" class="inline-block px-3 py-1 bg-purple-500/20 text-purple-300 text-xs rounded-md font-bold mb-2 border border-purple-500/30">Analiz Ediliyor...</div>
                        <p id="vibe-desc" class="text-sm text-slate-400 italic">"..."</p>
                    </div>

                    <div class="glass rounded-2xl p-6 hover:bg-white/5 transition">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="p-2 bg-emerald-500/20 rounded-lg text-emerald-400"><i class="fa-solid fa-mountain-sun"></i></div>
                            <h4 class="font-semibold">CoÄŸrafya</h4>
                        </div>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between"><span class="text-slate-400">RakÄ±m:</span> <span id="geo-alt" class="font-mono text-emerald-300">0m</span></div>
                            <div class="flex justify-between"><span class="text-slate-400">EÄŸim:</span> <span id="geo-slope" class="font-mono text-emerald-300">%0</span></div>
                            <div class="flex justify-between"><span class="text-slate-400">Durum:</span> <span id="geo-walk" class="text-white">Analiz Ediliyor</span></div>
                        </div>
                    </div>

                    <div class="col-span-1 sm:col-span-2 glass rounded-2xl p-6">
                         <h4 class="font-semibold mb-4 text-slate-300">DetaylÄ± Puanlar</h4>
                         <div class="space-y-4">
                             <div>
                                 <div class="flex justify-between text-xs mb-1">
                                     <span class="text-slate-400">YeÅŸil Alan & Sosyal</span>
                                     <span id="score-green-val" class="text-white font-bold">0</span>
                                 </div>
                                 <div class="w-full bg-slate-700 rounded-full h-2"><div id="score-green-bar" class="bg-emerald-500 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div></div>
                             </div>
                             <div>
                                 <div class="flex justify-between text-xs mb-1">
                                     <span class="text-slate-400">YerleÅŸim Kalitesi (Okul/Hastane)</span>
                                     <span id="score-settle-val" class="text-white font-bold">0</span>
                                 </div>
                                 <div class="w-full bg-slate-700 rounded-full h-2"><div id="score-settle-bar" class="bg-blue-500 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div></div>
                             </div>
                             <div>
                                 <div class="flex justify-between text-xs mb-1">
                                     <span class="text-slate-400">Sessizlik & Huzur</span>
                                     <span id="score-noise-val" class="text-white font-bold">0</span>
                                 </div>
                                 <div class="w-full bg-slate-700 rounded-full h-2"><div id="score-noise-bar" class="bg-amber-500 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div></div>
                             </div>
                         </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // --- AYARLAR ---
        // Render'dan aldÄ±ÄŸÄ±n URL'i buraya yapÄ±ÅŸtÄ±r. (Sonunda /hesapla OLMASIN, kod ekler)
        // Ã–rn: "https://yasam-skoru-xxxx.onrender.com"
        const BASE_API_URL = "https://yasam-skoru-api.onrender.com";

        // Harita AyarlarÄ±
        const map = L.map('map').setView([41.0082, 28.9784], 13); // Ä°stanbul Merkez
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap contributors &copy; CARTO'
        }).addTo(map);

        let selectedMarker = null;
        let selectedLat = null;
        let selectedLon = null;

        // Harita TÄ±klama OlayÄ±
        map.on('click', function(e) {
            selectedLat = e.latlng.lat;
            selectedLon = e.latlng.lng;

            if (selectedMarker) {
                map.removeLayer(selectedMarker);
            }

            selectedMarker = L.marker([selectedLat, selectedLon]).addTo(map);

            // UI GÃ¼ncelle
            document.getElementById('lat-val').innerText = selectedLat.toFixed(5);
            document.getElementById('lon-val').innerText = selectedLon.toFixed(5);
            document.getElementById('coords-display').classList.remove('hidden');

            const btn = document.getElementById('analyze-btn');
            btn.disabled = false;
            btn.classList.remove('bg-slate-700', 'text-slate-400', 'cursor-not-allowed');
            btn.classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-500', 'hover:scale-105');
            btn.innerHTML = `<span>Analiz Et</span> <i class="fa-solid fa-rocket"></i>`;
        });

        // API Fonksiyonu
        async function analyzeLocation() {
            if (!selectedLat || !selectedLon) return;

            // Loading GÃ¶ster
            const loading = document.getElementById('loading-screen');
            const loadingText = document.getElementById('loading-text');
            loading.classList.remove('hidden');

            const messages = ["Uydu gÃ¶rÃ¼ntÃ¼leri iÅŸleniyor...", "GÃ¼rÃ¼ltÃ¼ haritasÄ± taranÄ±yor...", "Yapay zeka skoru hesaplÄ±yor..."];
            let msgIdx = 0;
            const msgInterval = setInterval(() => {
                loadingText.innerText = messages[msgIdx];
                msgIdx = (msgIdx + 1) % messages.length;
            }, 3000);

            try {
                // --- API Ä°STEÄžÄ° ---
                const response = await fetch(`${BASE_API_URL}/hesapla`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ lat: selectedLat, lon: selectedLon })
                });

                if (!response.ok) throw new Error("API HatasÄ±");

                const data = await response.json();

                // Verileri Doldur
                updateUI(data);

                // SonuÃ§larÄ± GÃ¶ster
                document.getElementById('results-section').classList.remove('hidden');

                // Scroll
                document.getElementById('results-section').scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                alert("Bir hata oluÅŸtu: " + error.message + "\nAPI adresini kontrol edin.");
            } finally {
                clearInterval(msgInterval);
                loading.classList.add('hidden');
            }
        }

        function updateUI(data) {
            const ozellik = data.ozellikler;
            const skor = data.skor_ozeti;

            // Genel Skor Dairesi
            const circle = document.getElementById('score-circle');
            const radius = 45;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (skor.genel_skor / 100) * circumference;

            circle.style.strokeDashoffset = offset;

            // Renk Belirle
            let color = "#ef4444"; // KÄ±rmÄ±zÄ±
            let label = "GeliÅŸtirilebilir";
            if(skor.genel_skor > 60) { color = "#f59e0b"; label = "Ä°yi"; } // SarÄ±
            if(skor.genel_skor > 80) { color = "#10b981"; label = "MÃ¼kemmel"; } // YeÅŸil

            circle.style.stroke = color;
            document.getElementById('main-score').innerText = skor.genel_skor;
            document.getElementById('main-score').style.color = color;
            const labelEl = document.getElementById('score-label');
            labelEl.innerText = label;
            labelEl.style.color = color;

            // Vibe & Geo
            document.getElementById('vibe-tag').innerText = ozellik.mahalle_karakteri.etiket;
            document.getElementById('vibe-desc').innerText = ozellik.mahalle_karakteri.aciklama;

            document.getElementById('geo-alt').innerText = ozellik.cografya.rakim;
            document.getElementById('geo-slope').innerText = ozellik.cografya.egim_orani;
            document.getElementById('geo-walk').innerText = ozellik.cografya.yurunebilirlik;

            // Barlar
            updateBar('score-green', skor.detaylar.yesil_sosyal);
            updateBar('score-settle', skor.detaylar.yerlesim);
            updateBar('score-noise', skor.detaylar.gurultu);
        }

        function updateBar(idPrefix, value) {
            document.getElementById(`${idPrefix}-val`).innerText = value;
            document.getElementById(`${idPrefix}-bar`).style.width = `${value}%`;
        }
    </script>
</body>
</html>